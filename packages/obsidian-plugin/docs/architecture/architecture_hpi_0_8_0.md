# Архитектура HPI 0.8.0

## Общее описание
HPI 0.8.0 — это платформа с приоритетом приватности и расширяемости для персональной и командной аналитики, поддерживающая несколько фронтов (Obsidian, Telegram Bot/Web Apps, веб-интерфейс) с единым бэкендом и гибридной стратегией хранения данных.

---

## Ключевые принципы
- **Приватность по умолчанию:** Все пользовательские данные хранятся локально. Облачная синхронизация — только по желанию пользователя.
- **Гибридное хранение:** Данные сохраняются в виде JSON-файлов локально, с возможностью синхронизации с выбранными облачными сервисами (Dropbox, Google Drive, WebDAV, либо сервер HPI с end-to-end шифрованием).
- **Слой абстракции:** Весь доступ к данным реализован через интерфейс DataProvider, что позволяет легко менять способ хранения (JSON, SQLite, облако и др.).
- **API-first:** Все фронты работают с бэкендом через единый API (REST/GraphQL), поддерживающий как чтение, так и изменение данных.
- **Гибкая генерация представлений:** Данные могут экспортироваться в Markdown (для Obsidian), JSON (для web/Telegram), HTML (для web apps).
- **Контрактные тесты:** Автоматические тесты-контракты гарантируют, что все фронты получают валидные и согласованные данные при любых изменениях бэкенда.

---

## Текстовая схема архитектуры

- **Слой данных:**
    - Локальные JSON-файлы (по умолчанию)
    - Опционально: SQLite или облачная синхронизация (с шифрованием)
- **Слой абстракции:**
    - Интерфейс DataProvider (get, list, save, delete, sync)
    - Реализации: JSONFileProvider, SQLiteProvider, CloudProvider
- **API-слой:**
    - REST/GraphQL эндпоинты для всех операций с данными
    - Аутентификация и контроль доступа (при необходимости)
- **Слой рендеринга:**
    - Генератор Markdown (экспорт для Obsidian)
    - Генератор JSON/HTML (web, Telegram)
    - Генератор графиков/изображений (PNG/SVG)
- **Фронты:**
    - Obsidian (Markdown-файлы)
    - Telegram Bot/Web Apps (формы, графики, интерактивный UI)
    - Веб-интерфейс (SPA/SSR)

---

## Поток пользовательских данных
1. Пользователь работает с любым фронтом (Obsidian, Telegram, Web).
2. Фронт взаимодействует с API бэкенда.
3. API обращается к данным через слой DataProvider.
4. Данные читаются/записываются в локальные JSON-файлы (или другое хранилище, если настроено).
5. Опционально: данные синхронизируются с облаком (шифруются при использовании сервера HPI).

---

## Преимущества
- Максимальная приватность и контроль пользователя
- Простая интеграция с Obsidian и другими локальными инструментами
- Масштабируемость до облака или БД при необходимости
- Лёгкая миграция между способами хранения
- Единый опыт для всех фронтов

---

## Пример интерфейса DataProvider (Python)
```python
class DataProvider:
    def get(self, item_id: str) -> dict: ...
    def list(self) -> list[dict]: ...
    def save(self, item: dict) -> None: ...
    def delete(self, item_id: str) -> None: ...
    def sync(self) -> None: ...  # Опционально для облака
```

---

## Возможные расширения
- Новые типы хранилищ (например, зашифрованные vault'ы, серверы для командной работы)
- Расширенная аналитика и AI-модули
- Плагинная система для новых фронтов и интеграций 