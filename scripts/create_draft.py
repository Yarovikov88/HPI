import os
import sys
from datetime import datetime

# –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
# __file__ -> scripts/create_draft.py
# os.path.dirname(...) -> scripts/
# os.path.dirname(...) -> hpi/
PROJECT_ROOT = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
DRAFT_FOLDER = os.path.join(PROJECT_ROOT, "reports_draft")

# –®–∞–±–ª–æ–Ω –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ñ–µ—Ä—ã
QUESTION_TEMPLATE = """| –í–æ–ø—Ä–æ—Å | –í–∞—Ä–∏–∞–Ω—Ç—ã | –û—Ç–≤–µ—Ç |
|:---|:---|:---:|
| 1. ... | 1-4 | |
| 2. ... | 1-4 | |
| 3. ... | 1-4 | |
| 4. ... | 1-4 | |
| 5. ... | 1-4 | |
| 6. ... | 1-4 | |
"""

# –®–∞–±–ª–æ–Ω –¥–ª—è PRO-—Ä–∞–∑–¥–µ–ª–æ–≤
PRO_TEMPLATE = """| –°—Ñ–µ—Ä–∞ –∂–∏–∑–Ω–∏ | –í–∞—à–∏ –æ—Ç–≤–µ—Ç—ã |
|:---|:---|
| üíñ –û—Ç–Ω–æ—à–µ–Ω–∏—è —Å –ª—é–±–∏–º—ã–º–∏ | |
| üè° –û—Ç–Ω–æ—à–µ–Ω–∏—è —Å —Ä–æ–¥–Ω—ã–º–∏ | |
| ü§ù –î—Ä—É–∑—å—è | |
| üíº –ö–∞—Ä—å–µ—Ä–∞ | |
| ‚ôÇÔ∏è –§–∏–∑–∏—á–µ—Å–∫–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ | |
| üß† –ú–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ | |
| üé® –•–æ–±–±–∏ –∏ —É–≤–ª–µ—á–µ–Ω–∏—è | |
| üí∞ –ë–ª–∞–≥–æ—Å–æ—Å—Ç–æ—è–Ω–∏–µ | |
"""

# –®–∞–±–ª–æ–Ω –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞ "–ú–æ–∏ –º–µ—Ç—Ä–∏–∫–∏"
METRICS_TEMPLATE = """| –°—Ñ–µ—Ä–∞ –∂–∏–∑–Ω–∏ | –ú–µ—Ç—Ä–∏–∫–∞ | –¢–µ–∫—É—â–µ–µ | –¶–µ–ª–µ–≤–æ–µ |
|:---|:---|:---:|:---:|
| üíñ –û—Ç–Ω–æ—à–µ–Ω–∏—è —Å –ª—é–±–∏–º—ã–º–∏ | (–ø—Ä–∏–º–µ—Ä: –∫–æ–ª-–≤–æ —Å–≤–∏–¥–∞–Ω–∏–π –≤ –Ω–µ–¥–µ–ª—é) | | |
| üè° –û—Ç–Ω–æ—à–µ–Ω–∏—è —Å —Ä–æ–¥–Ω—ã–º–∏ | (–ø—Ä–∏–º–µ—Ä: –∫–æ–ª-–≤–æ –∑–≤–æ–Ω–∫–æ–≤ —Ä–æ–¥–∏—Ç–µ–ª—è–º) | | |
| ü§ù –î—Ä—É–∑—å—è | (–ø—Ä–∏–º–µ—Ä: –∫–æ–ª-–≤–æ –≤—Å—Ç—Ä–µ—á —Å –¥—Ä—É–∑—å—è–º–∏) | | |
| üíº –ö–∞—Ä—å–µ—Ä–∞ | (–ø—Ä–∏–º–µ—Ä: % –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–ª–∞–Ω–∞) | | |
| ‚ôÇÔ∏è –§–∏–∑–∏—á–µ—Å–∫–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ | (–ø—Ä–∏–º–µ—Ä: —Å—Ä–µ–¥–Ω–µ–µ –∫–æ–ª-–≤–æ —à–∞–≥–æ–≤ –≤ –¥–µ–Ω—å) | | |
| üß† –ú–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ | (–ø—Ä–∏–º–µ—Ä: –æ—Ü–µ–Ω–∫–∞ —É—Ä–æ–≤–Ω—è —Å—Ç—Ä–µ—Å—Å–∞ 1-10) | | |
| üé® –•–æ–±–±–∏ –∏ —É–≤–ª–µ—á–µ–Ω–∏—è | (–ø—Ä–∏–º–µ—Ä: —á–∞—Å–æ–≤ –Ω–∞ —Ö–æ–±–±–∏ –≤ –Ω–µ–¥–µ–ª—é) | | |
| üí∞ –ë–ª–∞–≥–æ—Å–æ—Å—Ç–æ—è–Ω–∏–µ | (–ø—Ä–∏–º–µ—Ä: % —Å–±–µ—Ä–µ–∂–µ–Ω–∏–π –æ—Ç –¥–æ—Ö–æ–¥–∞) | | |
"""

# –û—Å–Ω–æ–≤–Ω–æ–π —à–∞–±–ª–æ–Ω —á–µ—Ä–Ω–æ–≤–∏–∫–∞
DRAFT_TEMPLATE = f"""
# HPI –û—Ç—á–µ—Ç

> [!NOTE]
> –î–∞—Ç–∞: {datetime.now().strftime('%Y-%m-%d')}
> –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –Ω–∏–∂–µ. –î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ —Å—Ñ–µ—Ä–∞–º –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —à–∫–∞–ª—É –æ—Ç 1 –¥–æ 4.

---

## 1. üíñ –û—Ç–Ω–æ—à–µ–Ω–∏—è —Å –ª—é–±–∏–º—ã–º–∏
{QUESTION_TEMPLATE}
## 2. üè° –û—Ç–Ω–æ—à–µ–Ω–∏—è —Å —Ä–æ–¥–Ω—ã–º–∏
{QUESTION_TEMPLATE}
## 3. ü§ù –î—Ä—É–∑—å—è
{QUESTION_TEMPLATE}
## 4. üíº –ö–∞—Ä—å–µ—Ä–∞
{QUESTION_TEMPLATE}
## 5. ‚ôÇÔ∏è –§–∏–∑–∏—á–µ—Å–∫–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ
{QUESTION_TEMPLATE}
## 6. üß† –ú–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ
{QUESTION_TEMPLATE}
## 7. üé® –•–æ–±–±–∏ –∏ —É–≤–ª–µ—á–µ–Ω–∏—è
{QUESTION_TEMPLATE}
## 8. üí∞ –ë–ª–∞–≥–æ—Å–æ—Å—Ç–æ—è–Ω–∏–µ
{QUESTION_TEMPLATE}

---

# HPI PRO

### 1. üõë –ú–æ–∏ –ø—Ä–æ–±–ª–µ–º—ã
{PRO_TEMPLATE}
### 2. üéØ –ú–æ–∏ —Ü–µ–ª–∏
{PRO_TEMPLATE}
### 3. üöß –ú–æ–∏ –±–ª–æ–∫–µ—Ä—ã
{PRO_TEMPLATE}
### 4. üìä –ú–æ–∏ –º–µ—Ç—Ä–∏–∫–∏
{METRICS_TEMPLATE}
### 5. üèÜ –ú–æ–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
{PRO_TEMPLATE}
"""

def create_draft_report():
    """
    –°–æ–∑–¥–∞–µ—Ç —Ñ–∞–π–ª —á–µ—Ä–Ω–æ–≤–∏–∫–∞ HPI –Ω–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É.
    """
    # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–¥–∏—Ä–æ–≤–∫—É UTF-8
    if sys.stdout.encoding != 'utf-8':
        try:
            sys.stdout.reconfigure(encoding='utf-8')
        except TypeError:
            pass

    os.makedirs(DRAFT_FOLDER, exist_ok=True)

    today_str = datetime.now().strftime("%Y-%m-%d")
    draft_filename = f"{today_str}_draft.md"
    draft_filepath = os.path.join(DRAFT_FOLDER, draft_filename)

    if os.path.exists(draft_filepath):
        print(f"üü° –ß–µ—Ä–Ω–æ–≤–∏–∫ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è ({draft_filename}) —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.")
        print("–ß—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π, —É–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–π —Ñ–∞–π–ª.")
        return

    try:
        with open(draft_filepath, 'w', encoding='utf-8') as f:
            f.write(DRAFT_TEMPLATE.strip())
        print(f"‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω —á–µ—Ä–Ω–æ–≤–∏–∫: {draft_filepath}")
        print("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –µ–≥–æ.")
    except Exception as e:
        print(f"üî¥ –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —á–µ—Ä–Ω–æ–≤–∏–∫–∞: {e}", file=sys.stderr)

if __name__ == "__main__":
    create_draft_report() 